# NotPetya

## Introduction
This is my first malware analysis without ANY external help (ex. a youtube video), so please be patient if there are some error in the reverse engineered code.

### A short NotPetya history
Petya is a family of encrypting malware that was first discovered in 2016. The malware targets Microsoft Windowsâ€“based systems, infecting the master boot record to execute a payload that encrypts a hard drive's file system table and prevents Windows from booting. It subsequently demands that the user make a payment in Bitcoin in order to regain access to the system.

Variants of Petya were first seen in March 2016, which propagated via infected e-mail attachments. In June 2017, a new variant of Petya was used for a global cyberattack, primarily targeting Ukraine. The new variant propagates via the EternalBlue exploit, which is generally believed to have been developed by the U.S. National Security Agency (NSA), and was used earlier in the year by the WannaCry ransomware.

Kaspersky Lab referred to this new version as NotPetya to distinguish it from the 2016 variants, due to these differences in operation. It looked like ransomware, but without functioning recovery feature it was equivalent to a wiper. The NotPetya attacks have been blamed on the Russian government, specifically the Sandworm hacking group within the GRU Russian military intelligence organization, by security researchers, Google, and several governments.

As always, more information can be found in [this wikipedia page](https://en.wikipedia.org/wiki/Petya_and_NotPetya).

### Malware files
-   63545fa195488ff51955f09833332b9660d18f8afb16bdf579134661962e548a.exe (NotPetya DLL "launcher")
-   perfc.dat (Actual DLL payload)
-   ...

### My files
-   *.json (OOAnalyzer generated file)
-   ...

## 63545fa195488ff51955f09833332b9660d18f8afb16bdf579134661962e548a.exe
This file is responsible for the execution of the malicious DLL.

There is not much to say about this executable, it simply writes the DLL into "%SystemRoot\perfc.dat" file, and then executes it. In particular, it load the #1 resource.

![The NotPetya's DLL "launcher"](https://github.com/Natisfaction/Reverse_Malware/blob/main/NotPetya/README_IMAGES/NotPetya_executable.png)

## perfc.dat
This is the malicious DLL

Firstly, the malware tries to acquire those privileges:
-   "SeShutdownPrivilege"
-   "SeDebugPrivilege"
-   "SeTcbPrivilege"

...

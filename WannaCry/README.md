# WannaCry

## Introduction

### Credits
Being first "real" reverse-engineered project, I didn't know really well how to do some things, I decided to look online, and I came across someone that was doing the same thing! Definately check him out:
- Youtube: [stacksmashing](https://youtube.com/@stacksmashing)

### A small WannaCry history
WannaCry is a well-known ransomware that was first discovered on May 12, 2017. It swiftly spread across the globe, infecting hundreds of thousands of computers in over 150 countries. The ransomware specifically targeted computers running the Microsoft Windows operating system, especially those lacking the necessary security updates.

WannaCry took advantage of a vulnerability in the Windows operating system known as EternalBlue. This vulnerability was initially developed by the United States National Security Agency (NSA) and later utilized by a group called the Shadow Brokers. By exploiting this vulnerability, WannaCry rapidly propagated through networks, targeting vulnerable systems and encrypting files, rendering them inaccessible to users. Once infected, victims were presented with a ransom note demanding payment in Bitcoin in exchange for the decryption key.

The primary method of initial infection for WannaCry was through phishing emails and malicious attachments. Once inside a network, it leveraged the EternalBlue exploit to propagate and infect other vulnerable systems. This aggressive spreading mechanism greatly contributed to the swift and extensive reach of the attack.

More details can be found on [this wikipedia page](https://en.wikipedia.org/wiki/WannaCry_ransomware_attack).

### Files
Those are the malware files
- 0466c30d11752dc81e27fd20d12ba53b418ee88fc4fed4e1a1b41a2016ede294.exe (WannaCry dropper)
- Tasksche.exe (Actual ransomware)
- wcry.XIA (Zip file containing file dropped by Tasksche.exe)
- wcry (Just the extracted zip folder)

## 0466c30d11752dc81e27fd20d12ba53b418ee88fc4fed4e1a1b41a2016ede294.exe
This file serves as the dropper for the malware. 

### Killswitch
The first thing WannaCry tries to do, is checking if the following url exist:
-   "http://www.ifferfsodp9ifjaposdfjhgosurijfaewrwergwea.com"

If the URL exists, the dropper does not proceed with any further actions. This URL acts as a killswitch, preventing the infection from spreading when it was unregistered. 

If the URL doesn't exist, the dropper proceeds with the infection process. 

### No parameters
First, it checks if it was launched with argumes, if not it creates a service with this details:
-   Name: "mssecsvc2.0"
-   Descryption: "Microsoft_Security_Center_(2.0)"
-   Binary path name: "*malware.exe* -m security"

Note that the service purpose is to launch the malware with 2 parameters.

Then the malware, drops the tasksche.exe file from the resource number 1831, and it puts it in the "C:\Windows\qeriuwjhrf" folder. Then, tasksche.exe gets executed with /i parameter.

### Parameters
When the malware is executed with the "-m security" parameters, it attempts to obtain a handle to the Service Control Manager. The purpose of this is to modify the Failure Actions of the mssecsvc2.0 service.

Then, a thread that will handle the Service Control requests is created, and connected to the SCManager.
That's all the dropped does, now let's jump into tasksche.exe

## Tasksche.exe
